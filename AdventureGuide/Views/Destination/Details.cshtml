@model AdventureGuide.Models.Destinations.Destination
@using AdventureGuide.Models.Destinations;

@{
    ViewData["Title"] = "Details";
}

<div class="mt-1">
    <div class="d-flex justify-content-between">
        <div>
            <div class="d-flex justify-content-start">
                <h3 class="mt-2">@Model.Name</h3>
                <div class="d-flex justify-content-start ml-3">
                    <p class="mt-3 mr-3 font-weight-light">Average rating:</p> <input id="input-6" name="input-6" class="rating rating-loading" value="@Model.Rating" data-min="0" data-max="5" data-step=".5" data-readonly="true">
                </div>
            </div>
            <div>
                <p>@Model.Address @Model.City @Model.State, @Model.Country @Model.Zip</p>
            </div>
            <div>
                @foreach (Keyword keyword in Model.Keywords)
                {
                    <div class="badge badge-info">@keyword.KeywordString</div>
                }
            </div>
            <hr />
            <div>
                @Model.Description
            </div>

            <div>
                <a asp-action="Index">Back to List</a>
            </div>
        </div>

        <div class="text-center">
            <img src="@Url.Content(Model.ImagePaths.First().Path)" style="max-width:256px;max-height:256px" alt="Destination image" />
            <form>
                <!-- TODO: implement route to view more photos-->
                <button class="btn btn-primary mt-2" type="submit">
                    View more photos
                </button>
            </form>
        </div>
    </div>
    <hr />

    <!--
    <div class="col-sm-12 p-05">
        <div class="card card-order-info p-1 d-flex justify-content-around h-100 border-none">
            <div class="card-body wrap-map flex-item">
                <div class="destination-map" id="map"></div>
            </div>
        </div>
    </div>
    -->
    <!--
    -->

    <div>
        <div class="d-flex justify-content-start">
            <h2>Reviews</h2>

            @if (User.Identity.IsAuthenticated)
            {
                <form>
                    <!-- TODO: implement route to add review IF it does not exist-->
                    <button class="btn-sm btn-primary ml-2 mt-2" type="submit">
                        Add a review for this place
                    </button>
                </form>
            }
            else
            { <!-- TODO: try to stay on destination details page after logging in/making account-->
                <a class="nav-link mt-1" asp-area="Identity" asp-page="/Account/Login">Log in to leave a review!</a>
            }
        </div>

        <div id="DestinationComment">
            <partial name="_ReviewDetails" model="Model.Reviews" />
        </div>
    </div>

    <script type="text/javascript">

    function SubmitReview(id)
    {
        var data = { "DestinationId": id, "Rating": parseFloat($("#StarRating").val()), "Comment": $("#UserComment").val() };
        $.ajax({
            method: 'POST',
            url: "@Url.Action("SubmitReview", "Destination")",
            data: JSON.stringify(data),
            timeout: 60000,
            dataType: "html",
            contentType: "application/json; charset=utf-8",
            success: function (response) {
                $("#UserComment").val("");
                $("#DestinationComment").html(response);
            }
        })
    }
    </script>
    <!--
    <link href="~/lib/leaflet/dist/leaflet.css" rel="stylesheet" />
    <script src="~/lib/leaflet/dist/leaflet.js"></script>
    <script src="~/js/MapHelper.js"></script>

    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAqtBnPXVollQ4Oh-0WyJ3g-vDgKPcH4Ew&callback=InitMap">
    </script>
        -->
</div>